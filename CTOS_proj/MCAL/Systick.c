/**********************************************************************/
/*  name       : Ahmed Elkhateeb                                       */
/*  SW         :  SYStem Timer                                                      */
/*  version    :  V01                                                 */
/*  DATA       : 15/11/2022                                            */
/*********************************************************************/
/**********************************************************************************************************************
 *  FILE DESCRIPTION
 *  -----------------------------------------------------------------------------------------------------------------*/
/**     \file  Systick.c
 *      \brief  System Timer systick  
 *
 *      \details  Driver to configure system timer 
 *
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  INCLUDES
 *********************************************************************************************************************/

#include "tm4c123gh6pm.h"

#include "Systick.h"
/**********************************************************************************************************************
*  LOCAL MACROS CONSTANT\FUNCTION
*********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL DATA
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL DATA
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTION PROTOTYPES
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  LOCAL FUNCTIONS
 *********************************************************************************************************************/

/**********************************************************************************************************************
 *  GLOBAL FUNCTIONS
 *********************************************************************************************************************/
static void (*STICK_CallBack)(void);
/*Function used by the main to point the callback pointer
*to a function in the app layer */
void Systick_CallbackRegisteringFn (void (*callbackPtr)(void))
{
    STICK_CallBack =  callbackPtr;
}


/*Init function*/
void SYSTICK_voidInit(void )
{
	
	#if CLOCK_SYS_TICK== STICK_AHB
        /*NVIC_ST_CTRL_R = 4, enable system clock source to Systick*/
        SET_BIT(NVIC_ST_CTRL_R, 2);
        /*current value register = 0, in case there were a garbage value*/
        NVIC_ST_CURRENT_R = 0;
	#elif CLOCK_SYS_TICK == STICK_AHB_DIV_4

        STICK -> STK_CTRL =0x00000000;	
 
	#else 
		#error "the error choise to file config "
	
	
	#endif 
}                       

/*function to start timer with a given number of ticks*/
void SYSTICK_voidSetIntervalPeriodic(uint32 ticks)
{
    SET_BIT(NVIC_ST_CTRL_R,0);
    SET_BIT(NVIC_ST_CTRL_R,1);
	NVIC_ST_RELOAD_R  = ticks;

}



/*IRQ Handler*/
void SysTick_Handler(void)
{

	// call the nafication function 
	STICK_CallBack();

}
/**********************************************************************************************************************
 *  END OF FILE: Systick.c
 *********************************************************************************************************************/
